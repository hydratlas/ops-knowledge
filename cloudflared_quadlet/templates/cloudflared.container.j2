[Unit]
Description=Cloudflare Tunnel
After=network-online.target
Wants=network-online.target

[Container]
Image={{ cloudflared_image }}
Exec=tunnel run
EnvironmentFile={{ cloudflared_config_dir }}/cloudflared.env
Network=host

# Write the container ID to a file for process tracking and management
PodmanArgs=--cidfile=/var/lib/{{ cloudflared_user }}/cloudflared.cid

# Security options
ReadOnly=true
NoNewPrivileges=true
DropCapability=all
AddCapability=CAP_NET_RAW
UserNS=auto

[Service]
User={{ cloudflared_user }}
Group={{ cloudflared_user }}
Restart=always

[Install]
WantedBy=multi-user.target