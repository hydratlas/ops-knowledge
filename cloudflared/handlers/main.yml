---
# Handlers for cloudflared role (k3s deployment)

- name: restart cloudflared deployment
  kubernetes.core.k8s:
    api_version: apps/v1
    kind: Deployment
    name: "{{ cloudflared_deployment_name }}"
    namespace: "{{ cloudflared_namespace }}"
    state: present
    definition:
      spec:
        template:
          metadata:
            annotations:
              kubectl.kubernetes.io/restartedAt: "{{ now(utc=True).isoformat() }}"
  delegate_to: "{{ groups['k3s_masters'][0] }}"
  run_once: true